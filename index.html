<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æˆ‘ä»¬çš„å†’é™©çºªå¿µå†Œ | HTML å•é¡µæ¨¡æ¿</title>
  <meta name="description" content="ä»¥ä¸åŒæ¸¸æˆé£æ ¼çš„ AI æ’ç”»åˆ¶ä½œçš„æ•°å­—çºªå¿µç½‘é¡µï¼šç›¸å†Œï¼ˆä¸»å›¾+å¤šå›¾ç¯ç®±ï¼‰ã€æ—¶é—´çº¿ã€éŸ³ä¹ã€åˆ†äº«ã€æ‰“å°ã€‚" />
  <style>
    :root{
      --bg:#0f1221; --panel:#181c33; --accent:#7aa2ff; --accent-2:#ffcb6b; --text:#e9ecff; --muted:#a9b2d0; --shadow:0 10px 30px rgba(0,0,0,.35); --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;}
    a{color:var(--accent);text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header.hero{position:relative;overflow:hidden;border-radius:var(--radius);background:radial-gradient(1200px 500px at 80% -10%, rgba(122,162,255,.25), transparent 60%), linear-gradient(180deg, #1a2040, #0f1221)}
    .hero-inner{display:grid;grid-template-columns:1.2fr .8fr;gap:24px;align-items:center;padding:42px 28px}
    @media (max-width:900px){.hero-inner{grid-template-columns:1fr}}
    .title{font-size:42px;line-height:1.15;margin:0 0 12px;font-weight:800}
    .subtitle{color:var(--muted);margin:0 0 18px}
    .tags{display:flex;flex-wrap:wrap;gap:8px;margin:18px 0}
    .tag{padding:6px 10px;border:1px solid rgba(255,255,255,.12);border-radius:999px;color:#d7ddff;font-size:12px;background:rgba(255,255,255,.04)}
    .btns{display:flex;flex-wrap:wrap;gap:12px;margin-top:16px}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:12px 16px;border-radius:12px;background:var(--accent);color:#081027;font-weight:700;box-shadow:var(--shadow);border:none;cursor:pointer}
    .btn.secondary{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18)}
    .cover{aspect-ratio:16/10;border-radius:16px;overflow:hidden;box-shadow:var(--shadow)}
    .cover img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.06) contrast(1.02)}

    section{margin-top:32px}
    h2.section-title{margin:8px 0 12px;font-size:24px}

    /* ç”Ÿæ—¥ç¥ç¦å›¾ç‰‡è‡ªé€‚åº” */
    .birthday-section {
      text-align: center;
      background: #181c33;
      border-radius: 16px;
      padding: 30px;
      margin-top: 40px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
    }
    .birthday-section img {
      width: 100%;
      height: auto;
      max-width: 600px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, .4);
    }
    .birthday-text { margin-top: 18px; font-size: 18px; color: #ffd479; }

    /* Gallery */
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    @media (max-width:900px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:560px){.grid{grid-template-columns:1fr}}
    .card{position:relative;overflow:hidden;border-radius:14px;background:var(--panel);box-shadow:var(--shadow);cursor:pointer}
    .card img{width:100%;height:100%;display:block;object-fit:cover;transition:transform .6s ease}
    .card:hover img{transform:scale(1.03)}
    .card.featured{grid-column:span 2;grid-row:span 2;position:relative}
    @media (max-width:900px){.card.featured{grid-column:span 2;grid-row:span 1}}
    @media (max-width:560px){.card.featured{grid-column:span 1}}
    .badge{position:absolute;top:8px;left:8px;background:linear-gradient(90deg,#ffd479,#ff9f4a);color:#301d00;font-weight:800;border-radius:999px;padding:6px 10px;font-size:12px;box-shadow:var(--shadow)}

    /* ä¸‹æ–¹å›ºå®šæ ‡é¢˜ä¸å‰¯æ ‡é¢˜ */
    .card-info {
      padding: 8px 10px 10px;
      text-align: center;
      color: var(--text);
      font-size: 14px;
      line-height: 1.4;
      background: var(--panel);
      border-radius: 0 0 14px 14px;
    }
    .card-info strong {
      display: block;
      font-weight: 700;
      font-size: 15px;
      color: #fff;
    }
    .card-info span {
      display: block;
      color: var(--muted);
      font-size: 13px;
      margin-top: 2px;
    }

    /* æ‚¬åœæµ®å±‚ï¼ˆæ¡Œé¢ç«¯ï¼‰ */
    .card-overlay {
      position:absolute; inset:0;
      background:rgba(0,0,0,0.55);
      display:flex; flex-direction:column;
      justify-content:flex-end; align-items:flex-start;
      opacity:0; transition:opacity .4s ease;
      padding:10px; border-radius:14px;
    }
    .card:hover .card-overlay{opacity:1;}
    .card-overlay strong{ color:#fff; font-size:15px; font-weight:700; margin-bottom:4px; }
    .card-overlay span{ color:#ddd; font-size:13px; }

    /* Lightbox */
    .lightbox{position:fixed;inset:0;background:rgba(4,6,14,.86);backdrop-filter:blur(3px);display:none;place-items:center;padding:0;z-index:50}
    .lightbox.open{display:grid}
    .lightbox-inner{
      max-width: 96vw; max-height: 96vh;
      position: relative; display: flex;
      align-items: center; justify-content: center;
      overflow: hidden; pointer-events: none; /* å®¹å™¨ä¸åƒäº‹ä»¶ï¼Œè®©æŒ‰é’®/å›¾ç‰‡åƒ */
    }
    /* å›¾ç‰‡ç”¨ transform æ§åˆ¶ç¼©æ”¾/å¹³ç§» */
    #lbImg{
      max-width: none; max-height: none;
      width: auto; height: auto;
      user-select: none; -webkit-user-drag: none;
      touch-action: none;
      transform-origin: center center;
      border-radius: 16px; box-shadow: var(--shadow);
      z-index: 1; pointer-events: auto;
    }
    /* é«˜ä¼˜å…ˆçº§çš„æŒ‰é’®ï¼Œå§‹ç»ˆå¯ç‚¹ */
    .nav{
      position:absolute; top:50%; transform:translateY(-50%);
      width:64px; height:64px; border-radius:50%;
      display:grid; place-items:center; background:rgba(0,0,0,.35);
      cursor:pointer; user-select:none; z-index:9999;
      pointer-events:auto; backdrop-filter:blur(2px);
      font-size:40px; color:#fff;
    }
    .nav.left{left:10px}
    .nav.right{right:10px}
    .lightbox .close{
      position:absolute; top:14px; right:14px;
      background:rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.25);
      color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer;
      z-index:9999; pointer-events:auto; backdrop-filter:blur(2px)
    }
    @media (max-width:640px){.nav{width:56px;height:56px;font-size:32px}.nav.left{left:6px}.nav.right{right:6px}}
    .grabbable{cursor:grab} .grabbing{cursor:grabbing}

    /* Timeline */
    .timeline{display:grid;gap:14px}
    .event{display:grid;grid-template-columns:120px 1fr;gap:16px;background:var(--panel);border-radius:14px;padding:14px;align-items:center}
    @media (max-width:700px){.event{grid-template-columns:1fr}}
    .stamp{font-weight:700;color:var(--accent-2)}
    .event .desc{color:var(--muted)}

    /* Timeline image thumbï¼ˆæ–°åŠ ï¼‰ */
    .event .thumb-wrap{
      margin-top:8px; border-radius:12px; overflow:hidden;
      background:rgba(255,255,255,.04); box-shadow: var(--shadow);
      cursor: zoom-in;
      max-width: 100%;
    }
    .event .thumb{
      width:100%; height:220px; object-fit:cover; display:block;
    }
    @media (max-width:700px){ .event .thumb{ height:180px; } }

    footer{margin:36px 0 4px;color:#95a2d9;text-align:center;opacity:.85}

    /* æ‰“å°éšè—ä¸å¿…è¦å…ƒç´  */
    @media print{.btns,.audio, .share, .nav, .badge{display:none !important}; body{background:#fff;color:#222}}
  </style>
</head>
<body>
  <div class="container">
    <header class="hero" role="banner">
      <div class="hero-inner">
        <div>
          <h1 class="title">æˆ‘ä»¬çš„æ—…ç¨‹ ğŸ ç”Ÿæ—¥çºªå¿µå†Œ</h1>
          <p class="subtitle">ä»¥ä¸åŒæ¸¸æˆé£æ ¼çš„æ’å›¾è®°å½•å½¼æ­¤çš„å›å¿†ï¼šå²è¯—ã€æµªæ¼«ã€è¯™è°ã€æ²»æ„ˆï¼Œå…¨éƒ¨æ±‡èšæˆä¸€æ®µåªå±äºæˆ‘ä»¬çš„æ—…ç¨‹ã€‚</p>
          <div class="tags" id="tagbar"></div>
          <div class="btns">
            <button class="btn" id="btnPlay">â–¶ æ’­æ”¾éŸ³ä¹</button>
            <button class="btn secondary share" id="btnShare">â†—ï¸ åˆ†äº«ç½‘é¡µ</button>
            <button class="btn secondary" onclick="window.print()">ğŸ–¨ æ‰“å°/å­˜PDF</button>
          </div>
        </div>
        <div class="cover"><img id="coverImg" alt="å°é¢" loading="lazy"/></div>
      </div>
    </header>

    <section class="birthday-section">
      <h2>ç”Ÿæ—¥ç¥ç¦ ğŸ‚ Birthday Wishes</h2>
      <img src="Birthday_Wish.png" alt="ç”Ÿæ—¥ç¥ç¦å›¾"/>
      <div class="birthday-text">æ„¿æˆ‘ä»¬å…±åŒçš„å†’é™©æ°¸è¿œå……æ»¡å…‰äº®ä¸æ¸©æŸ”ã€‚ç”Ÿæ—¥å¿«ä¹ï¼</div>
    </section>

    <section aria-labelledby="gal-title">
      <h2 class="section-title" id="gal-title">ç›¸å†Œ ğŸ–¼ï¸ Gallery</h2>
      <div class="grid" id="gallery"></div>
    </section>

    <section aria-labelledby="timeline-title">
      <h2 class="section-title" id="timeline-title">çºªå¿µæ—¶åˆ» â³ Moments</h2>
      <div class="timeline" id="timeline"></div>
    </section>

    <section class="audio" aria-labelledby="audio-title">
      <h2 class="section-title" id="audio-title">é…ä¹ ğŸµ BGM</h2>
      <audio id="bgm" preload="auto" controls style="width:100%">
        <source src="Proof_of_a_hero.mp3" type="audio/mpeg"/>
        ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
      </audio>
    </section>

    <footer>Â© <span id="year"></span> Our Adventure â€¢ Made with â¤</footer>
  </div>

  <!-- è½»é‡ Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="é¢„è§ˆå¤§å›¾">
    <div class="lightbox-inner">
      <button class="close" id="lbClose" aria-label="å…³é—­">âœ•</button>
      <div class="nav left" id="lbPrev" aria-label="ä¸Šä¸€å¼ ">â€¹</div>
      <div class="nav right" id="lbNext" aria-label="ä¸‹ä¸€å¼ ">â€º</div>
      <img id="lbImg" alt="é¢„è§ˆå›¾"/>
    </div>
  </div>

  <script>
    // â€”â€” â‘  æ•°æ®åŒºï¼šæŒ‰éœ€æ›¿æ¢ â€”â€”
    const COVER_URL = "Cover.webp";

    const album = [
      {
        title:"æ€ªç‰©çŒäººï¼šä¸–ç•Œ", featured:true,
        main:"images/Monster_Hunter_world/1.jpg",
        gallery:[
          "images/Monster_Hunter_world/1.jpg",
          "images/Monster_Hunter_world/2.webp",
          "images/Monster_Hunter_world/3.webp",
          "images/Monster_Hunter_world/4.webp",
          "images/Monster_Hunter_world/5.webp",
          "images/Monster_Hunter_world/6.webp"
        ],
        caption:"çŒï¼å¤ªåˆ€ï¼é»‘é¾™ï¼äººè¶Šå¤šçŒ«è¶Šå¿«"
      },
      {
        title:"åŒå½±å¥‡å¢ƒ",
        main:"images/Split_Fiction/0.jpg",
        gallery:[
          "images/Split_Fiction/0.jpg",
          "images/Split_Fiction/1.jpg","images/Split_Fiction/2.jpg",
          "images/Split_Fiction/3.jpg","images/Split_Fiction/4.jpg",
          "images/Split_Fiction/5.jpg","images/Split_Fiction/6.jpg"
        ],
        caption:"å·¦å³äº’æçš„é»˜å¥‘æµ‹è¯•"
      },
      {
        title:"åŒäººæˆè¡Œ",
        main:"images/It_Takes_Two/0.jpg",
        gallery:["images/It_Takes_Two/0.jpg","images/It_Takes_Two/1.jpg","images/It_Takes_Two/2.jpg","images/It_Takes_Two/3.jpg","images/It_Takes_Two/4.jpg","images/It_Takes_Two/5.jpg"],
        caption:"åµæ¶æ‹…å½“Ã—å’Œå¥½æ‹…å½“=é€šå…³æ­æ¡£"
      },
      {
        title:"We Were Here Series",
        main:"images/We_Were_Here/0.jpg",
        gallery:["images/We_Were_Here/0.jpg","images/We_Were_Here/1.jpg","images/We_Were_Here/2.jpg","images/We_Were_Here/3.jpg","images/We_Were_Here/4.jpg","images/We_Were_Here/5.jpg","images/We_Were_Here/6.jpg"],
        caption:"åˆ†å·¥æ˜¯é­‚ï¼Œéº¦å…‹é£æ˜¯å‘½"
      },
      {
        title:"è‰¾å°”ç™»æ³•ç¯",
        main:"images/Elden_Ring/0.webp",
        gallery:["images/Elden_Ring/0.webp","images/Elden_Ring/1.jpg","images/Elden_Ring/2.jpg","images/Elden_Ring/3.jpg","images/Elden_Ring/4.jpg","images/Elden_Ring/5.jpg"],
        caption:"äººé‚£ä¹ˆå¤šè¿˜ä¸æ˜¯ä¹±æ€ï¼Ÿï¼"
      },
      {
        title:"Carry The Glass",
        main:"images/Carry_The_Glass/0.jpg",
        gallery:["images/Carry_The_Glass/0.jpg","images/Carry_The_Glass/1.jpg","images/Carry_The_Glass/2.jpg","images/Carry_The_Glass/3.jpg","images/Carry_The_Glass/4.jpg","images/Carry_The_Glass/5.jpg"],
        caption:"åˆ«æŠ–ï¼æ¢¦æƒ³æ˜“ç¢"
      },
      {
        title:"Goat Simulator 3",
        main:"images/Goat_Simulator_3/0.jpg",
        gallery:["images/Goat_Simulator_3/0.jpg","images/Goat_Simulator_3/1.jpg","images/Goat_Simulator_3/1.jpg","images/Goat_Simulator_3/2.jpg","images/Goat_Simulator_3/3.jpg","images/Goat_Simulator_3/4.gif","images/Goat_Simulator_3/5.jpg"],
        caption:"æ­£ç»äº‹ä¸åšï¼Œåªä¼šå’©å’©é—¯ç¥¸"
      },
      {
        title:"å°å°æ¢¦é­‡ 3",
        main:"images/Little_Nightmares_3/0.jpg",
        gallery:["images/Little_Nightmares_3/0.jpg","images/Little_Nightmares_3/1.jpg","images/Little_Nightmares_3/2.jpg","images/Little_Nightmares_3/3.jpg","images/Little_Nightmares_3/4.jpg","images/Little_Nightmares_3/5.jpg","images/Little_Nightmares_3/6.jpg","images/Little_Nightmares_3/7.jpg"],
        caption:"é»‘æš—å¾ˆå¤§ï¼Œæˆ‘ä»¬æŠ±å›¢æ›´æš–"
      }
    ];

    // åœ¨éœ€è¦çš„äº‹ä»¶ä¸Šå¯é€‰æ·»åŠ  img å­—æ®µï¼ˆç¤ºä¾‹ç»™ä¸¤ä¸ªï¼‰
    const milestones = [
      {date:"2025-05-26", desc:"åœ¨æ€ªç‰©çŒäººä¸–ç•Œé‡Œç›¸é‡", img:"images/Monster_Hunter_world/7.jpg"},
      {date:"2025-06-16", desc:"ç¬¬ä¸€æ¬¡ä¸€èµ·é€šå…³åŒäººåˆä½œæ¸¸æˆ åŒå½±å¥‡å¢ƒ", img:"images/Split_Fiction/3.jpg"},
      {date:"2025-06-18", desc:"å¤šæ¬¡å°è¯•ä¸é…åˆåä»¥å…¨æˆå°±é€šå…³ We Were Here Expeditions: The Friendship", img:"images/We_Were_Here/Mayhem1.PNG"},
      {date:"2025-06-22", desc:"ä¸€èµ·é€šå…³äº†åŒäººåˆä½œæ¸¸æˆ åŒäººæˆè¡Œ", img:"images/It_Takes_Two/1.jpg"},
      {date:"2025-06-29", desc:"ä¸€èµ·é€šå…³äº† We Were Here Tooï¼Œ å„è‡ªå®Œæˆäº†è§’è‰²çš„æˆå°±"},
      {date:"2025-07-11", desc:"ä¸€èµ·é€šå…³äº† We Were Here Together å¹¶è·å¾—äº†å¤§éƒ¨åˆ†æˆå°±ï¼Œå› ä¸ºbugå¯¼è‡´æ‹¿ä¸åˆ°éšè—æˆå°±"},
      {date:"2025-07-27", desc:"å¼€å¯äº†åœ¨è‰¾å°”ç™»æ³•ç¯çš„æ—…ç¨‹ï¼Œå››ä½å°ä¼™ä¼´ä¸€èµ·è”æœºå¼€è’", img:"images/Elden_Ring/2.jpg"},
      {date:"2025-08-29", desc:"ä¸€èµ·é€šå…³äº† We Were Here Foreverï¼Œ å…³å¡éš¾åº¦æ˜æ˜¾æå‡ï¼Œä½†æ˜¯éš¾ä¸å€’æˆ‘ä»¬"},
      {date:"2025-10-05", desc:"å¶ç„¶é—´å‘ç°å±±ç¾Šæ¨¡æ‹Ÿå™¨3åŸæ¥è¿™ä¹ˆå¥½ç©ï¼Œæ–­æ–­ç»­ç»­ä¸€å‘¨å¤šæŠŠæ¸¸æˆå†…éƒ½é€›å¾—å¹²å¹²å‡€å‡€", img:"images/Goat_Simulator_3/4.gif"},
      {date:"2025-10-09", desc:"ç»è¿‡å¤šå¤©çš„åšæŒå®Œæˆäº†æ¬ç»ç’ƒçš„æŒ‘æˆ˜", img:"images/Carry_The_Glass/2.jpg"},
      {date:"2025-10-12", desc:"æ¸¸æˆåˆšåˆšæ¨å‡ºï¼Œç”¨äº†ä¸‰å¤©ä¸€èµ·é€šå…³å°å°æ¢¦é­‡3", img:"images/Little_Nightmares_3/1.jpg"},
    ];

    const tags = ["æ•°å­—ç›¸å†Œ", "çºªå¿µç¤¼ç‰©", "æ¸¸æˆä¸–ç•Œä¹‹æ—…", "ç›¸é‡ç¼˜åˆ†", "æ€ªç‰©çŒäºº"];

    // â€”â€” â‘¡ æ¸²æŸ“ â€”â€” 
    const $ = (sel,root=document)=>root.querySelector(sel);
    const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));

    const coverImg = $("#coverImg");
    coverImg.src = COVER_URL;
    coverImg.alt = "å°é¢ / Cover";

    const tagbar = $("#tagbar");
    tagbar.innerHTML = tags.map(t=>`<span class="tag">${t}</span>`).join("");

    // ç›¸å†Œï¼šæ ‡é¢˜+captionï¼ˆå›ºå®šï¼‰ + æ‚¬åœæµ®å±‚
    const grid = $("#gallery");
    grid.innerHTML = album.map((item,i)=>{
      const cls = item.featured ? 'card featured' : 'card';
      const badge = item.featured ? '<span class="badge">CENTER</span>' : '';
      const cap = item.caption ? `<span>${item.caption}</span>` : '';
      return `
        <figure class="${cls}" data-i="${i}" title="${item.title}${item.caption ? ' Â· ' + item.caption : ''}">
          ${badge}
          <img src="${item.main}" alt="${item.title}" loading="lazy"/>
          <div class="card-overlay">
            <strong>${item.title}</strong>
            ${cap}
          </div>
          <div class="card-info">
            <strong>${item.title}</strong>
            ${cap}
          </div>
        </figure>
      `;
    }).join("");

    // â€”â€” â‘¢ ç¯ç®±ï¼šç›¸å†Œ & æ—¶é—´çº¿å¤ç”¨ï¼Œæ”¯æŒç¼©æ”¾/æ‹–æ‹½ï¼ŒæŒ‰é’®ä¸è¢«é®æŒ¡ â€”â€” 
    const lightbox = $("#lightbox"), lbImg = $("#lbImg");
    const inner = document.querySelector('.lightbox-inner');
    const lbClose = $("#lbClose"), lbPrev = $("#lbPrev"), lbNext = $("#lbNext");

    // æ¨¡å¼åˆ‡æ¢ï¼šç›¸å†Œ or è‡ªå®šä¹‰ï¼ˆæ—¶é—´çº¿å•å›¾ï¼‰
    let usingCustomImages = false;
    let customImages = [];

    // ç¼©æ”¾/æ‹–æ‹½çŠ¶æ€
    let scale = 1, minScale = 1, maxScale = 6;
    let tx = 0, ty = 0;
    let isPanning = false, startX=0, startY=0;
    let lastTouchDist = 0;

    function setTransform(){ lbImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`; }

    function getViewportBox(){
      const rect = inner.getBoundingClientRect();
      const leftW  = lbPrev ? lbPrev.getBoundingClientRect().width : 0;
      const rightW = lbNext ? lbNext.getBoundingClientRect().width : 0;
      const PAD = 8;
      return { w: Math.max(0, rect.width  - leftW - rightW - PAD*2),
               h: Math.max(0, rect.height - PAD*2) };
    }

    function fitToScreen(){
      const iw = lbImg.naturalWidth  || lbImg.width;
      const ih = lbImg.naturalHeight || lbImg.height;
      const box = getViewportBox();
      if(!iw || !ih || !box.w || !box.h) return;
      const contain = Math.min(box.w/iw, box.h/ih);
      minScale = contain;
      scale = contain;
      tx = 0; ty = 0;
      setTransform();
    }

    // ç›¸å†Œå›¾ç‰‡è£…è½½
    let currentAlbumIndex = 0, currentImageIndex = 0;

    function showImage(){
      // å¦‚æœæ˜¯æ—¶é—´çº¿/è‡ªå®šä¹‰æ¨¡å¼ï¼Œç”¨ customImagesï¼›å¦åˆ™ç”¨ç›¸å†Œçš„ gallery
      const imgs = (usingCustomImages && customImages.length)
        ? customImages
        : ((album[currentAlbumIndex].gallery && album[currentAlbumIndex].gallery.length)
            ? album[currentAlbumIndex].gallery
            : [album[currentAlbumIndex].main]);

      const len = imgs.length;
      currentImageIndex = ((currentImageIndex % len) + len) % len;

      const src = imgs[currentImageIndex];
      lbImg.onload = async ()=>{
        try{ if('decode' in lbImg) await lbImg.decode(); }catch(e){}
        fitToScreen();
      };
      lbImg.src = src;
      lbImg.alt = usingCustomImages ? "é¢„è§ˆå›¾" : album[currentAlbumIndex].title;
    }

    // ç›¸å†Œæ¨¡å¼
    function openLightbox(i){
      usingCustomImages = false;
      currentAlbumIndex = i; currentImageIndex = 0;
      showImage(); lightbox.classList.add('open');
    }
    // æ—¶é—´çº¿/å•å›¾æ¨¡å¼
    function openLightboxWithSrc(src, title="é¢„è§ˆå›¾"){
      usingCustomImages = true;
      customImages = [src];
      lightbox.classList.add('open');
      lbImg.onload = async ()=>{ try{ if('decode' in lbImg) await lbImg.decode(); }catch(e){} fitToScreen(); };
      lbImg.src = src;
      lbImg.alt = title;
      currentImageIndex = 0;
    }

    function closeLightbox(){ lightbox.classList.remove('open'); }
    function nextImage(step=1){ currentImageIndex += step; showImage(); }

    // Grid click -> open
    grid.addEventListener('click', e=>{
      const fig = e.target.closest('.card'); if(!fig) return;
      openLightbox(+fig.dataset.i);
    });

    // Buttons
    lbClose.addEventListener('click', closeLightbox);
    lbNext.addEventListener('click', ()=> nextImage(1));
    lbPrev.addEventListener('click', ()=> nextImage(-1));
    lightbox.addEventListener('click', e=>{ if(e.target===lightbox) closeLightbox(); });

    // Resize
    window.addEventListener('resize', ()=>{ if(lightbox.classList.contains('open')) fitToScreen(); });

    // æ»šè½®ç¼©æ”¾ï¼ˆä»¥æŒ‡é’ˆä½ç½®ä¸ºä¸­å¿ƒï¼‰
    inner.addEventListener('wheel', (e)=>{
      if(!lightbox.classList.contains('open')) return;
      e.preventDefault();
      const rect = lbImg.getBoundingClientRect();
      const cx = rect.left + rect.width/2;
      const cy = rect.top + rect.height/2;
      const mx = e.clientX - cx - tx;
      const my = e.clientY - cy - ty;

      const delta = Math.sign(e.deltaY);      // ä¸Šæ¨ç¼©å°ï¼Œä¸‹æ‹‰æ”¾å¤§
      const factor = Math.pow(1.1, -delta);   // æ¯æ­¥ 10%
      const prev = scale;
      scale = Math.max(minScale*0.5, Math.min(maxScale, scale*factor));
      const k = scale/prev;

      tx -= mx*(k-1);
      ty -= my*(k-1);
      setTransform();
    },{passive:false});

    // åŒå‡»ï¼šé€‚åº” <-> 2x
    inner.addEventListener('dblclick', ()=>{
      if(scale <= minScale*1.01){ scale = Math.min(maxScale, minScale*2); }
      else{ scale = minScale; tx = 0; ty = 0; }
      setTransform();
    });

    // é¼ æ ‡æ‹–æ‹½å¹³ç§»ï¼ˆå¿½ç•¥æŒ‰é’®åŒºåŸŸï¼‰
    inner.addEventListener('mousedown', (e)=>{
      if(e.target.closest('.nav, .close')) return;
      isPanning = true;
      startX = e.clientX - tx; startY = e.clientY - ty;
      lbImg.classList.add('grabbable','grabbing');
    });
    window.addEventListener('mousemove', (e)=>{ if(!isPanning) return; tx = e.clientX - startX; ty = e.clientY - startY; setTransform(); });
    window.addEventListener('mouseup', ()=>{ isPanning=false; lbImg.classList.remove('grabbing'); });

    // è§¦æ‘¸ï¼šå•æŒ‡æ‹–åŠ¨ã€åŒæŒ‡ç¼©æ”¾ï¼ˆå¿½ç•¥æŒ‰é’®ï¼‰
    let touchMode=null;
    inner.addEventListener('touchstart', (e)=>{
      if(e.target.closest('.nav, .close')) return;
      if(e.touches.length===1){
        touchMode='pan';
        startX = e.touches[0].clientX - tx;
        startY = e.touches[0].clientY - ty;
      }else if(e.touches.length===2){
        touchMode='pinch';
        lastTouchDist = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
      }
    },{passive:true});
    inner.addEventListener('touchmove', (e)=>{
      if(touchMode==='pan' && e.touches.length===1){
        tx = e.touches[0].clientX - startX; ty = e.touches[0].clientY - startY; setTransform();
      }else if(touchMode==='pinch' && e.touches.length===2){
        e.preventDefault();
        const d = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        const prev = scale; const factor = d / (lastTouchDist||d);
        scale = Math.max(minScale*0.98, Math.min(maxScale, scale*factor));
        lastTouchDist = d; setTransform();
      }
    },{passive:false});
    inner.addEventListener('touchend', ()=>{ if(touchMode && event.touches?.length===0) touchMode=null; }, {passive:true});

    // é”®ç›˜ï¼šEsc å…³é—­ï¼›å·¦å³åˆ‡å›¾ï¼›0 é€‚åº”ï¼›+/- ç¼©æ”¾
    window.addEventListener('keydown', (e)=>{
      if(!lightbox.classList.contains('open')) return;
      if(e.key==='Escape') closeLightbox();
      if(e.key==='ArrowRight') nextImage(1);
      if(e.key==='ArrowLeft')  nextImage(-1);
      if(e.key==='0'){ fitToScreen(); }
      if(e.key==='='||e.key==='+'){ scale = Math.min(maxScale, scale*1.1); setTransform(); }
      if(e.key==='-'||e.key==='_'){ scale = Math.max(minScale*0.98, scale/1.1); setTransform(); }
    });

    // â€”â€” â‘£ æ—¶é—´çº¿æ¸²æŸ“ï¼ˆå¸¦å¯é€‰ç¼©ç•¥å›¾ï¼‰ â€”â€” 
    const timeline = $("#timeline");
    timeline.innerHTML = milestones.map(m=>`
      <div class="event">
        <div class="stamp">${m.date}</div>
        <div class="desc">
          <div>${m.desc}</div>
          ${m.img ? `
            <div class="thumb-wrap" data-src="${m.img}">
              <img class="thumb" src="${m.img}" alt="timeline image for ${m.date}" loading="lazy"/>
            </div>` : ``}
        </div>
      </div>
    `).join("");

    // ç»‘å®šï¼šç‚¹å‡»æ—¶é—´çº¿ç¼©ç•¥å›¾ -> ç”¨åŒä¸€ç¯ç®±é¢„è§ˆ
    $$(".thumb-wrap").forEach(el=>{
      el.addEventListener("click", ()=>{
        const src = el.getAttribute("data-src");
        openLightboxWithSrc(src);
      });
    });

    // å¹´ä»½
    $("#year").textContent = new Date().getFullYear();

    // éŸ³ä¹
    const bgm = $("#bgm"), btnPlay = $("#btnPlay");
    let playing = false;
    btnPlay.addEventListener('click', async ()=>{
      try{
        if(!playing){ await bgm.play(); btnPlay.textContent='â¸ æš‚åœéŸ³ä¹'; playing = true; }
        else{ bgm.pause(); btnPlay.textContent='â–¶ æ’­æ”¾éŸ³ä¹'; playing = false; }
      }catch(err){ alert('è¯·å…ˆä¸é¡µé¢äº¤äº’åå†æ’­æ”¾éŸ³é¢‘ï¼ˆæµè§ˆå™¨é™åˆ¶ï¼‰'); }
    });

    // åˆ†äº«
    const btnShare = $("#btnShare");
    btnShare?.addEventListener('click', async ()=>{
      if(navigator.share){
        await navigator.share({title: document.title, text: 'é€ç»™ä½ çš„æ•°å­—çºªå¿µå†Œ', url: location.href});
      }else{ alert('ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒåŸç”Ÿåˆ†äº«ï¼Œå¯å¤åˆ¶åœ°å€æ é“¾æ¥'); }
    });
  </script>
</body>
</html>
